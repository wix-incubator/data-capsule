!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define("data-capsule",[],e):"object"==typeof exports?exports["data-capsule"]=e():t["data-capsule"]=e()}("undefined"!=typeof self?self:this,(function(){return function(t){var e={};function n(r){if(e[r])return e[r].exports;var o=e[r]={i:r,l:!1,exports:{}};return t[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return n.m=t,n.c=e,n.d=function(t,e,r){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)n.d(r,o,function(e){return t[e]}.bind(null,o));return r},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="https://static.parastorage.com/services/data-capsule/1.542.0/",n(n.s=49)}({0:function(t,e,n){"use strict";n.d(e,"c",(function(){return o})),n.d(e,"a",(function(){return i})),n.d(e,"e",(function(){return a})),n.d(e,"b",(function(){return c})),n.d(e,"d",(function(){return u}));var r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(t,e)};function o(t,e){function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}var i=function(){return(i=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var o in e=arguments[n])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)};function a(t,e){var n={};for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&e.indexOf(r)<0&&(n[r]=t[r]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(r=Object.getOwnPropertySymbols(t);o<r.length;o++)e.indexOf(r[o])<0&&Object.prototype.propertyIsEnumerable.call(t,r[o])&&(n[r[o]]=t[r[o]])}return n}function c(t,e,n,r){return new(n||(n=Promise))((function(o,i){function a(t){try{u(r.next(t))}catch(t){i(t)}}function c(t){try{u(r.throw(t))}catch(t){i(t)}}function u(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,c)}u((r=r.apply(t,e||[])).next())}))}function u(t,e){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(i){return function(c){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=a.trys,(o=o.length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(t){i=[6,t],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,c])}}}Object.create;Object.create},1:function(t,e,n){"use strict";n.d(e,"j",(function(){return o})),n.d(e,"g",(function(){return i})),n.d(e,"c",(function(){return a})),n.d(e,"i",(function(){return c})),n.d(e,"a",(function(){return u})),n.d(e,"e",(function(){return s})),n.d(e,"f",(function(){return f})),n.d(e,"h",(function(){return l})),n.d(e,"d",(function(){return p})),n.d(e,"b",(function(){return d}));var r={NOT_FOUND:new Error("Key was not found in capsule"),SERVER_ERROR:new Error("Failed to perform operarion on server"),LOCAL_STORAGE_UNSUPPORTED:new Error("LocalStorage is not supported"),COOKIE_CONSENT_DISALLOWED:new Error("The item cannot be set because the user has not approved the category it belongs to")};function o(t){return Object.keys(r).map((function(t){return r[t]})).find((function(e){return e.message===t}))||new Error(t)}var i="|",a="#",c="capsule",u=2e3,s=8e3,f=r.NOT_FOUND,l=r.SERVER_ERROR,p=r.LOCAL_STORAGE_UNSUPPORTED,d=r.COOKIE_CONSENT_DISALLOWED},10:function(t,e,n){"use strict";n.d(e,"a",(function(){return s}));var r=n(7),o=n.n(r),i=n(12),a=n.n(i),c=n(2),u=n(4),s=function(){function t(t){void 0===t&&(t=new u.a),this.storageStrategy=c.a.verify(t)}return t.prototype.start=function(t,e){if(!t||"function"!=typeof t)throw new Error("start function must get a verifier function as a first argument");if(e&&"function"!=typeof e)throw new Error("the interceptor must be a function");var n=c.a.verify(this.storageStrategy);this.stopListener=a()("data-capsule",(function(r,i){if("string"!=typeof r.data)return;var a=o()(r.data,"|",3),c=a[0],u=a[1],s=a[2],f=function(t,e){if("resolve"===t){var n=[t,JSON.stringify({data:e})].join("|");return i(n)}var r=[t,e].join("|");return i(r)};if(!t(r.source,r.origin,c))return f("reject","message was not authorized");var l=n[u].bind(n),p=JSON.parse(s).data,d=p[p.length-1],g=e?e(d,r.source,r.origin,c):d;return p[p.length-1]=g,l.apply(void 0,p).then((function(t){return f("resolve",t)})).catch((function(t){return f("reject",t.message||t)}))}))},t.prototype.stop=function(){this.stopListener&&this.stopListener()},t}()},12:function(t,e,n){t.exports=n(18)},18:function(t,e,n){"use strict";var r,o=n(8),i=n(6),a=n(19),c=(r=a)&&r.__esModule?r:{default:r};function u(t,e){try{return(0,i.parseConnectionMessage)(t)===e}catch(t){return!1}}function s(t){try{return t.ports[0]}catch(t){}}function f(t){t.postMessage(o.connectionSuccessMsg)}var l=function(){};t.exports=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:l;if(!t||"string"!=typeof t)throw new Error("listener function expects to recieve a scope<string> as a first argument");var n=function(n){if(u(n.data,t)){var r=s(n);r&&(f(r),(0,c.default)(r,e))}};return window.addEventListener("message",n),function(){return window.removeEventListener("message",n)}}},19:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t,e){t.onmessage=function(n){var o=n.data,i=(0,r.parseChannelMessage)(o),a=i.id,c={data:i.payload,origin:n.origin,lastEventId:n.lastEventId,source:n.source,ports:n.ports};e(c,(function(e){t.postMessage((0,r.constructChannelMessage)(e,a))}))}};var r=n(6)},2:function(t,e,n){"use strict";n.d(e,"a",(function(){return r}));var r=function(){function t(){}return t.verify=function(e){if(e instanceof t)return e;throw new Error("This class must extend BaseStorage!")},t.prototype.extendScope=function(t){return t},t}()},4:function(t,e,n){"use strict";n.d(e,"a",(function(){return v}));var r=n(0),o=n(2),i=n(1),a=["essential","functional","analytics","advertising"];function c(t){!function(t){if(!t)return;if(-1===a.indexOf(t)){var e=a.map((function(t){return"'"+t+"'"})).join(", ");throw new Error("category must be one of "+e)}}(t);var e=("object"==typeof consentPolicyManager&&consentPolicyManager.getCurrentConsentPolicy&&consentPolicyManager.getCurrentConsentPolicy()||"object"==typeof Wix&&Wix.Utils&&Wix.Utils.getCurrentConsentPolicy&&Wix.Utils.getCurrentConsentPolicy()||{}).policy;if(void 0!==e&&!e[t])throw i.b}function u(t){var e=t.split(i.c),n=e[0],r=e[1],o=n.split(i.g),a=o[1],c=o[2];return void 0===c?{namespace:a,key:r}:{namespace:a,scope:c,key:r}}function s(t){return JSON.parse(t)}function f(t){void 0===t&&(t=i.i+i.g);for(var e=[],n=0;n<localStorage.length;n++){var o=localStorage.key(n);if(o.startsWith(t)){var a=localStorage.getItem(o);e.push(Object(r.a)(Object(r.a)({size:o.length+a.length,originalKey:o},s(a)),u(o)))}}return e}function l(t){return!!t.expiration&&t.createdAt+1e3*t.expiration<=Date.now()}function p(t,e){return void 0===e&&(e=t.records[0]),localStorage.removeItem(e.originalKey),{records:e===t.records[0]?t.records.slice(1):t.records.filter((function(t){return t.originalKey!==e.originalKey})),requiredSpace:t.requiredSpace-e.size}}function d(t,e){return t.lastUsed-e.lastUsed}function g(t){return t.records.length>0&&t.requiredSpace>0}function y(t){var e={records:f(),requiredSpace:t};!function(t){for(t.records.sort(d);g(t);)t=p(t)}(e=function(t){return t.records.filter((function(t){return l(t)})).forEach((function(e){return t=p(t,e)})),t}(e))}var v=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(r.c)(e,t),e.prototype.setItem=function(t,e,n){return Object(r.b)(this,void 0,void 0,(function(){var o,i;return Object(r.d)(this,(function(r){o=h(t,n),i=b(e,n),n.category&&c(n.category);try{localStorage.setItem(o,i)}catch(t){y(o.length+i.length),localStorage.setItem(o,i)}return[2]}))}))},e.prototype.getItem=function(t,e){var n,r=h(t,e);try{n=localStorage.getItem(r)}catch(t){return Promise.reject(i.d)}return(n=n&&s(n))&&!l(n)?(function(t,e){var n=e.expiration,r=e.createdAt;localStorage.setItem(t,b(e.value,{expiration:n,createdAt:r}))}(r,n),Promise.resolve(n.value)):Promise.reject(i.f)},e.prototype.removeItem=function(t,e){return t=h(t,e),localStorage.removeItem(t),Promise.resolve()},e.prototype.getAllItems=function(t){var e=m(t),n={};return f(e).forEach((function(t){l(t)||(n[t.key]=t.value)})),Promise.resolve(n)},e}(o.a);function h(t,e){return m(e)+t}function m(t){return[i.i,t.namespace,(e=t.scope,"string"==typeof e?e:JSON.stringify(e))].filter((function(t){return t})).join(i.g)+i.c;var e}function b(t,e){var n={lastUsed:Date.now(),createdAt:e.createdAt||Date.now(),expiration:e.expiration,value:t};return JSON.stringify(n)}},49:function(t,e,n){var r=n(50);"undefined"!=typeof window&&(window.DataCapsuleTools=r),t.exports=r},5:function(t,e,n){"use strict";n.d(e,"a",(function(){return i}));var r=n(0),o=n(2),i=function(t){function e(e){var n=e.strategy,i=Object(r.e)(e,["strategy"]),a=t.call(this)||this;return a.storageStrategy=o.a.verify(n),a._options=i,a}return Object(r.c)(e,t),e.prototype.setItem=function(t,e,n){return Object(r.b)(this,void 0,Promise,(function(){var o;return Object(r.d)(this,(function(r){return o=this._buildValidateOptions(this._options,n),[2,this.storageStrategy.setItem(t,e,o)]}))}))},e.prototype.getItem=function(t,e){var n=this._buildValidateOptions(this._options,e);return this.storageStrategy.getItem(t,n)},e.prototype.removeItem=function(t,e){var n=this._buildValidateOptions(this._options,e);return this.storageStrategy.removeItem(t,n)},e.prototype.getAllItems=function(t){var e=this._buildValidateOptions(this._options,t);return this.storageStrategy.getAllItems(e)},e.prototype._buildValidateOptions=function(t,e){if((e=Object(r.a)(Object(r.a)({},t),e)).scope=this.storageStrategy.extendScope(e.scope),!function(t){return"string"==typeof t.namespace}(e))throw new Error("namespace is required and should be a string");return e},e}(o.a)},50:function(t,e,n){"use strict";n.r(e);var r=n(2);n.d(e,"BaseStorage",(function(){return r.a}));var o=n(5);n.d(e,"DataCapsule",(function(){return o.a}));var i=n(4);n.d(e,"LocalStorageStrategy",(function(){return i.a}));var a=n(1);n.d(e,"NOT_FOUND",(function(){return a.f}));var c=n(10);n.d(e,"FrameStorageListener",(function(){return c.a}))},6:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.parseConnectionMessage=e.constructConnectionMessage=e.parseChannelMessage=e.constructChannelMessage=void 0;var r=n(8);e.constructChannelMessage=function(t,e){return e?e+r.messageDelimiter+t:t},e.parseChannelMessage=function(t){var e=t.indexOf(r.messageDelimiter);return-1===e?{id:null,payload:t}:{id:t.slice(0,e),payload:t.slice(e+1)}},e.constructConnectionMessage=function(t){return r.connectionRequestMsg+r.messageDelimiter+t},e.parseConnectionMessage=function(t){var e=t.indexOf(r.messageDelimiter);if(-1===e||t.slice(0,e)!==r.connectionRequestMsg)throw new Error("Invalid connection message");return t.slice(e+1)}},7:function(t,e,n){"use strict";t.exports=function(t,e,n){var r=t.split(e,n);if(r.length===n){var o=0;o="string"==typeof e?r.join(e).length:r.reduce((function(r,o,i){var a=0;return i+1<n&&(a=t.slice(r).match(e).shift().length),r+o.length+a}),0),r[n-1]+=t.slice(o)}return r}},8:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});e.connectionRequestMsg="req_con",e.connectionSuccessMsg="connection_success",e.messageDelimiter="|",e.deafultConnectionMaxTimeout=200,e.deafultMessageMaxTimeout=5e3}})}));
//# sourceMappingURL=frame-listener.bundle.min.js.map