!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("data-capsule",[],t):"object"==typeof exports?exports["data-capsule"]=t():e["data-capsule"]=t()}("undefined"!=typeof self?self:this,(function(){return function(e){var t={};function n(r){if(t[r])return t[r].exports;var o=t[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(r,o,function(t){return e[t]}.bind(null,o));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="https://static.parastorage.com/services/data-capsule/1.376.0/",n(n.s=52)}({0:function(e,t){var n=function(){function e(){var t=this;["setItem","getItem","removeItem","getAllItems"].forEach((function(n){if(t[n]===e.prototype[n])throw new Error("BaseStorage method ["+n+"] must be overriden!")}))}var t=e.prototype;return t.extendScope=function(e){return e},t.setItem=function(e,t,n){throw n},t.getItem=function(e,t){throw t},t.removeItem=function(e,t){throw t},t.getAllItems=function(e){throw e},e.verify=function(t){if(t instanceof e)return t;throw new Error("This class must extend BaseStorage!")},e}();e.exports=n},1:function(e,t){var n={NOT_FOUND:new Error("Key was not found in capsule"),SERVER_ERROR:new Error("Failed to perform operarion on server"),LOCAL_STORAGE_UNSUPPORTED:new Error("LocalStorage is not supported")};e.exports={PREFIX_SEPARATOR:"|",KEY_SEPARATOR:"#",STORAGE_PREFIX:"capsule",NOT_FOUND:n.NOT_FOUND,CONNECTION_MAX_TIMEOUT:2e3,MESSAGE_MAX_TIMEOUT:8e3,SERVER_ERROR:n.SERVER_ERROR,toError:function(e){return Object.keys(n).map((function(e){return n[e]})).find((function(t){return t.message===e}))||new Error(e)},LOCAL_STORAGE_UNSUPPORTED:n.LOCAL_STORAGE_UNSUPPORTED}},14:function(e,t,n){var r=n(5),o=n(15),i=n(0),s=n(1),a=s.CONNECTION_MAX_TIMEOUT,u=s.MESSAGE_MAX_TIMEOUT,c=s.toError,f=function(e){var t,n;function i(t,n,r,o){var i;void 0===o&&(o={}),(i=e.call(this)||this).target=t,i.origin=n,i.token=r,i.channel=void 0,i.opts=o;var s=i.opts,c=s.connectionMaxTimeout,f=void 0===c?a:c,l=s.messageMaxTimeout,p=void 0===l?u:l;return i.connectionMaxTimeout=f,i.messageMaxTimeout=p,i}n=e,(t=i).prototype=Object.create(n.prototype),t.prototype.constructor=t,t.__proto__=n;var s=i.prototype;return s.getChannel=function(){var e=this;return this.channel?Promise.resolve(this.channel):o("data-capsule",{target:this.target,origin:this.origin,connectionMaxTimeout:this.connectionMaxTimeout,messageMaxTimeout:this.messageMaxTimeout}).then((function(t){return e.channel=t,t}))},s.sendCommand=function(e,t){var n=this,o={data:t};return this.getChannel().then((function(t){return t([n.token,e,JSON.stringify(o)].join("|")).then((function(e){var t=r(e.data,"|",2),n=t[0],o=t[1];if("reject"===n)throw c(o);return JSON.parse(o).data}))}))},s.setItem=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return this.sendCommand("setItem",t)},s.getItem=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return this.sendCommand("getItem",t)},s.removeItem=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return this.sendCommand("removeItem",t)},s.getAllItems=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return this.sendCommand("getAllItems",t)},i}(i);e.exports=f},15:function(e,t,n){e.exports=n(16)},16:function(e,t,n){"use strict";var r,o=n(4),i=n(3),s=n(17),a=(r=s)&&r.__esModule?r:{default:r};e.exports=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.targetOrigin,r=void 0===n?"*":n,s=t.connectionMaxTimeout,u=void 0===s?o.deafultConnectionMaxTimeout:s,c=t.messageMaxTimeout,f=void 0===c?o.deafultMessageMaxTimeout:c;return new Promise((function(t,n){setTimeout((function(){n(new Error("max timeout of "+u+"ms exceeded"))}),u);var s=new window.MessageChannel;s.port1.onmessage=function(e){if(e.data===o.connectionSuccessMsg)return t((0,a.default)(s.port1,{messageMaxTimeout:f}));n(new Error("connection could not establise"))};var c=(0,i.constructConnectionMessage)(e);window.parent.postMessage(c,r,[s.port2])}))}},17:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){var n=t.messageMaxTimeout,r={};return e.onmessage=function(e){var t=(0,o.parseChannelMessage)(e.data),n=t.id,i=t.payload;if(r[n]){var s={data:i,origin:e.origin,lastEventId:e.lastEventId,source:e.source,ports:e.ports};r[n](s)}},function(t,i){return new Promise((function(a,u){setTimeout((function(){u(new Error("max timeout of "+n+"ms exceeded"))}),n);var c=(0,s.default)(),f=(0,o.constructChannelMessage)(t,c);return r[c]=a,e.postMessage(f,i)}))}};var r,o=n(3),i=n(18),s=(r=i)&&r.__esModule?r:{default:r}},18:function(e,t,n){var r=n(19),o=n(20);e.exports=function(e,t,n){var i=t&&n||0;"string"==typeof e&&(t="binary"===e?new Array(16):null,e=null);var s=(e=e||{}).random||(e.rng||r)();if(s[6]=15&s[6]|64,s[8]=63&s[8]|128,t)for(var a=0;a<16;++a)t[i+a]=s[a];return t||o(s)}},19:function(e,t){var n="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof window.msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto);if(n){var r=new Uint8Array(16);e.exports=function(){return n(r),r}}else{var o=new Array(16);e.exports=function(){for(var e,t=0;t<16;t++)0==(3&t)&&(e=4294967296*Math.random()),o[t]=e>>>((3&t)<<3)&255;return o}}},20:function(e,t){for(var n=[],r=0;r<256;++r)n[r]=(r+256).toString(16).substr(1);e.exports=function(e,t){var r=t||0,o=n;return[o[e[r++]],o[e[r++]],o[e[r++]],o[e[r++]],"-",o[e[r++]],o[e[r++]],"-",o[e[r++]],o[e[r++]],"-",o[e[r++]],o[e[r++]],"-",o[e[r++]],o[e[r++]],o[e[r++]],o[e[r++]],o[e[r++]],o[e[r++]]].join("")}},3:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.parseConnectionMessage=t.constructConnectionMessage=t.parseChannelMessage=t.constructChannelMessage=void 0;var r=n(4);t.constructChannelMessage=function(e,t){return t?t+r.messageDelimiter+e:e},t.parseChannelMessage=function(e){var t=e.indexOf(r.messageDelimiter);return-1===t?{id:null,payload:e}:{id:e.slice(0,t),payload:e.slice(t+1)}},t.constructConnectionMessage=function(e){return r.connectionRequestMsg+r.messageDelimiter+e},t.parseConnectionMessage=function(e){var t=e.indexOf(r.messageDelimiter);if(-1===t||e.slice(0,t)!==r.connectionRequestMsg)throw new Error("Invalid connection message");return e.slice(t+1)}},4:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.connectionRequestMsg="req_con",t.connectionSuccessMsg="connection_success",t.messageDelimiter="|",t.deafultConnectionMaxTimeout=200,t.deafultMessageMaxTimeout=5e3},5:function(e,t,n){"use strict";e.exports=function(e,t,n){var r=e.split(t,n);if(r.length===n){var o=0;o="string"==typeof t?r.join(t).length:r.reduce((function(r,o,i){var s=0;return i+1<n&&(s=e.slice(r).match(t).shift().length),r+o.length+s}),0),r[n-1]+=e.slice(o)}return r}},52:function(e,t,n){var r=n(53);"undefined"!=typeof window&&(window.DataCapsuleTools=r),e.exports=r},53:function(e,t,n){var r=n(14),o=n(1).NOT_FOUND,i=n(0),s=n(8);e.exports={NOT_FOUND:o,BaseStorage:i,DataCapsule:s,FrameStorageStrategy:r}},8:function(e,t,n){var r=n(0);var o=function(e){var t,n;function o(t){var n,o=t.strategy,i=t.namespace,s=t.scope;return(n=e.call(this)||this).storageStrategy=r.verify(o),n._options={namespace:i,scope:s},n}n=e,(t=o).prototype=Object.create(n.prototype),t.prototype.constructor=t,t.__proto__=n;var i=o.prototype;return i._buildValidateOptions=function(e,t){return(t=Object.assign({},e,t)).scope=this.storageStrategy.extendScope(t.scope),function(e){if(!e.namespace)throw new Error("namespace is required");if("string"!=typeof e.namespace)throw new Error("namespace should be a string")}(t),t},i.setItem=function(e,t,n){return n=this._buildValidateOptions(this._options,n),this.storageStrategy.setItem(e,t,n)},i.getItem=function(e,t){return t=this._buildValidateOptions(this._options,t),this.storageStrategy.getItem(e,t)},i.removeItem=function(e,t){return t=this._buildValidateOptions(this._options,t),this.storageStrategy.removeItem(e,t)},i.getAllItems=function(e){return e=this._buildValidateOptions(this._options,e),this.storageStrategy.getAllItems(e)},o}(r);e.exports=o}})}));
//# sourceMappingURL=frame.bundle.min.js.map